$(function () {
  "use strict";
  $(function () {
    $(".preloader").fadeOut();
  }),
    jQuery(document).on("click", ".mega-dropdown", function (a) {
      a.stopPropagation();
    });
  var a = function () {
    (window.innerWidth > 0 ? window.innerWidth : this.screen.width) < 1170
      ? ($("body").addClass("mini-sidebar"),
        $(".navbar-brand span").hide(),
        $(".sidebartoggler i").addClass("ti-menu"))
      : ($("body").removeClass("mini-sidebar"), $(".navbar-brand span").show());
    var a =
      (window.innerHeight > 0 ? window.innerHeight : this.screen.height) - 1;
    (a -= 0) < 1 && (a = 1),
      a > 0 && $(".page-wrapper").css("min-height", a + "px");
  };
  $(window).ready(a),
    $(window).on("resize", a),
    $(".sidebartoggler").on("click", function () {
      $("body").hasClass("mini-sidebar")
        ? ($("body").trigger("resize"),
          $("body").removeClass("mini-sidebar"),
          $(".navbar-brand span").show())
        : ($("body").trigger("resize"),
          $("body").addClass("mini-sidebar"),
          $(".navbar-brand span").hide());
    }),
    $(".nav-toggler").on("click", function () {
      $("body").toggleClass("show-sidebar"),
        $(".nav-toggler i").toggleClass("ti-menu"),
        $(".nav-toggler i").addClass("ti-close");
    }),
    $(".search-box a, .search-box .app-search .srh-btn").on(
      "click",
      function () {
        $(".app-search").toggle(200);
      }
    ),
    $(".right-side-toggle").on("click", function () {
      $(".right-sidebar").slideDown(50),
        $(".right-sidebar").toggleClass("shw-rside");
    }),
    $(".floating-labels .form-control")
      .on("focus blur", function (a) {
        $(this)
          .parents(".form-group")
          .toggleClass("focused", "focus" === a.type || this.value.length > 0);
      })
      .trigger("blur"),
    $(function () {
      for (
        var a = window.location,
          i = $("ul#sidebarnav a")
            .filter(function () {
              return this.href == a;
            })
            .addClass("active")
            .parent()
            .addClass("active");
        i.is("li");

      )
        i = i.parent().addClass("in").parent().addClass("active");
    }),
    $(function () {
      $('[data-toggle="tooltip"]').tooltip();
    }),
    $(function () {
      $('[data-toggle="popover"]').popover();
    }),
    $(function () {
      $("#sidebarnav").AdminMenu();
    }),
    $(
      ".scroll-sidebar, .right-side-panel, .message-center, .right-sidebar"
    ).perfectScrollbar(),
    $("body").trigger("resize"),
    $(".list-task li label").on("click", function () {
      $(this).toggleClass("task-done");
    }),
    $('a[data-action="collapse"]').on("click", function (a) {
      a.preventDefault(),
        $(this)
          .closest(".card")
          .find('[data-action="collapse"] i')
          .toggleClass("ti-minus ti-plus"),
        $(this).closest(".card").children(".card-body").collapse("toggle");
    }),
    $('a[data-action="expand"]').on("click", function (a) {
      a.preventDefault(),
        $(this)
          .closest(".card")
          .find('[data-action="expand"] i')
          .toggleClass("mdi-arrow-expand mdi-arrow-compress"),
        $(this).closest(".card").toggleClass("card-fullscreen");
    }),
    $('a[data-action="close"]').on("click", function () {
      $(this).closest(".card").removeClass().slideUp("fast");
    }),
    $(".custom-file-input").on("change", function () {
      var a = $(this).val();
      $(this).next(".custom-file-label").html(a);
    });
});

function filterHref(href) {
  href = href.replace(/\d+$/, "");

  return href;
}
$(window).resize(function () {
  titleHead();
});
function titleHead() {
  var titlePage = $(".row.page-titles h3.text-themecolor").html();
  var headTitle = "ONCAR - " + titlePage;
  // $(document).attr("title", headTitle);
  // document.title = document.title+' - '+titlePage);

  if ($(window).width() <= 768) {
    $(".navbarTitle").html(titlePage);
    $(".row.page-titles").hide();
  } else {
    $(".row.page-titles").show();
    $(".dropMobileSearch").hide();
    $(".dropNotify").show();
  }
}
$("#collapseSearch").on("hidden.bs.collapse", function () {
  if ($(window).width() < 768) {
    $(".dropNotify").slideUp(300, function () {
      $(".dropMobileSearch").slideDown(300);
    });
  }
});
$(function () {
  // Check if it is iOS
  var isiOS = navigator.userAgent.match(/(iPad|iPhone|iPod)/g) ? true : false;
  if (isiOS === true) {
    var tempCSS = $("a").css("-webkit-tap-highlight-color");
    $("body")
      .css("cursor", "pointer")
      .css("-webkit-tap-highlight-color", "rgba(0, 0, 0, 0)");
    $("a").css("-webkit-tap-highlight-color", tempCSS);
    $(document).on("click", "a", function (event) {
      event.preventDefault();

      var $aTag = $(this);
      var href = $aTag.attr("href");
      if (
        href.length > 0 &&
        href != "#" &&
        href != "javascript:;" &&
        $aTag.attr("target") != "" &&
        !$aTag.hasClass("has-arrow")
      ) {
        location.href = href;
      }
    });
    // $('body').addClass('sidenav-toggled');
    $(".dash-widget").removeClass("col-md-3");
    $(".dash-widget").addClass("col-md-4");
  }
});
$("form input").on("invalid", function () {
  // Find the tab-pane that this element is inside, and get the id
  var closest = $(this).closest(".tab-pane");
  var id = closest.attr("id");

  // Find the link that corresponds to the pane and have it show
  $('.nav a[href="#' + id + '"]').tab("show");
  if ($(this).closest("label").length) {
    var element = $(this).closest("label");
  } else {
    var element = this;
  }
  if ($(element).hasClass("dropify")) {
    inputImageAlert(element, "error");
  } else {
    inputAlert(element, "error");
  }

  // Only want to do it once
  return false;
});
$("form input").on("keyup", function () {
  $(this).removeClass("error");
});
function ucfirst(str) {
  return str.replace(/\w\S*/g, function (txt) {
    return txt.charAt(0).toUpperCase() + txt.substr(1).toLowerCase();
  });
}
$(".text-capitalize").keyup(function () {
  var cp_value = ucfirst($(this).val());
  $(this).val(cp_value);
});
function inputAlert(elem, color, time = 3000, pholder = true) {
  $(elem).addClass(color);
  console.log(pholder);
  if ($(elem).attr("placeholder").length && color == "error") {
    if (pholder) {
      toast("warning", "Verifique: " + $(elem).attr("placeholder"));
    }
  }
  setTimeout(function () {
    $(elem).removeClass(color);
  }, time);
}
function inputImageAlert(elem, color, time = 3000, pholder = true) {
  $(elem).closest(".dropify-wrapper").addClass(color);
  if ($(elem).attr("placeholder") && color == "error") {
    if (pholder) {
      toast("warning", "Verifique: " + $(elem).attr("placeholder"));
    }
  }
  setTimeout(function () {
    $(elem).closest(".dropify-wrapper").removeClass(color);
  }, time);
}

function datePicker(elem, callback = false) {
  var data = $(elem).data();

  data.placeholder = data.placeholder ? data.placeholder + " " : "";
  data.opens = data.opens ? data.opens : "left";
  data.start = data.start ? moment(data.start) : moment().startOf("month");
  data.end = data.end ? moment(data.end) : moment().endOf("month");

  function cb(start, end) {
    $(elem)
      .find("span")
      .html(
        data.placeholder +
          start.format("DD/MM/YYYY") +
          " à " +
          end.format("DD/MM/YYYY")
      );
    $(elem).find('[name="min"]').val(start.format("YYYY-MM-DD"));
    $(elem).find('[name="max"]').val(end.format("YYYY-MM-DD"));
    if (callback) {
      callback();
    }
  }

  $(elem).daterangepicker(
    {
      startDate: data.start,
      endDate: data.end,
      opens: data.opens,
      autoApply: true,
      ranges: {
        Hoje: [moment(), moment()],
        Ontem: [moment().subtract(1, "days"), moment().subtract(1, "days")],
        "Esta semana": [moment().startOf("week"), moment().endOf("week")],
        "Este mês": [moment().startOf("month"), moment().endOf("month")],
        "Ultimo mês": [
          moment().subtract(1, "month").startOf("month"),
          moment().subtract(1, "month").endOf("month"),
        ],
        "Próximo mês": [
          moment().add(1, "month").startOf("month"),
          moment().add(1, "month").endOf("month"),
        ],
        "Este ano": [moment().startOf("year"), moment().endOf("year")],
      },
      locale: {
        format: "DD/MM/YYYY",
        separator: " - ",
        fromLabel: "De",
        toLabel: "Para",
        customRangeLabel: "Período de tempo...",
        weekLabel: "S",
        daysOfWeek: ["Dom", "Seg", "Ter", "Qua", "Qui", "Sex", "Sab"],
        monthNames: [
          "Janeiro",
          "Fevereiro",
          "Março",
          "Abril",
          "Maio",
          "Junho",
          "Julho",
          "Agosto",
          "Setembro",
          "Outubro",
          "Novembro",
          "Dezembro",
        ],
        applyLabel: "Confirmar",
        cancelLabel: "Cancelar",
        firstDay: 1,
      },
    },
    cb
  );
  cb(data.start, data.end);
}
$(".d-none.autoremove").remove();

// var showPwd = ``;
// $(showPwd).insertAfter('[type="password"]');

$('[type="password"]').keyup(function () {
  var name = $(this).attr("name");

  if ($(this).val().length > 0) {
    $('.showPwd[data-pwd="' + name + '"]').show("fast");
  } else {
    $('.showPwd[data-pwd="' + name + '"]').hide("fast");
  }
});

$(".showPwd").click(function () {
  var input = $(this).data("pwd");
  var $input = $('[name="' + input + '"]');
  console.log(input);

  if ($input.attr("type") == "text") {
    $(this).find("i").removeClass("fa-eye-slash").addClass("fa-eye");
    $input.attr("type", "password");
  } else {
    $(this).find("i").removeClass("fa-eye").addClass("fa-eye-slash");
    $input.attr("type", "text");
  }
});

$("#form-ChangePwd").submit(function (e) {
  e.preventDefault();
  var btn = $(this).find('[type="submit"]');

  btn.html('<i class="fas fa-spinner fa-pulse"></i>');
  btn.attr("disabled", true);

  $.ajax({
    url: "controller/changePwd.php",
    type: "post",
    dataType: "json",
    data: $(this).serialize(),
  }).done(function (json) {
    if (json.cod == 1) {
      $("#modalPassword").modal("hide");
      toast("success", json.message);
      $("#form-ChangePwd .showPwd").hide("fast");
      $("#form-ChangePwd input").val("");
    } else {
      swal("Ops!", json.message, "warning");
    }
    btn.html("Salvar");
    btn.attr("disabled", false);
  });
});

$("select.form-control").not(".disable-select2").select2();
$("select.custom-select").not(".disable-select2").select2();

// $(function() {
//   new ZammadChat({
//     background: '#293272',
// 		fontSize: '12px',
// 		lang: 'pt-br',
//     chatId: 1
//   });
// });
